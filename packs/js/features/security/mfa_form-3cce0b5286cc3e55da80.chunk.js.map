{"version":3,"file":"packs/js/features/security/mfa_form-3cce0b5286cc3e55da80.chunk.js","mappings":"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","sources":["webpack://soapbox/./app/soapbox/features/security/mfa/disable-otp-form.tsx","webpack://soapbox/./app/soapbox/features/security/mfa/enable-otp-form.tsx","webpack://soapbox/./app/soapbox/features/security/mfa/otp-confirm-form.tsx","webpack://soapbox/./app/soapbox/features/security/mfa-form.tsx"],"sourcesContent":["import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";import\"core-js/modules/es.object.to-string.js\";import\"core-js/modules/es.promise.js\";import\"core-js/modules/es.promise.finally.js\";import\"core-js/modules/es.array.push.js\";import React,{useState,useCallback}from'react';import{useIntl,defineMessages,FormattedMessage}from'react-intl';import{useHistory}from'react-router-dom';import{disableMfa}from'soapbox/actions/mfa';import{Button,Form,FormGroup,Input,FormActions,Stack,Text}from'soapbox/components/ui';import{useAppDispatch}from'soapbox/hooks';import toast from'soapbox/toast';var messages=defineMessages({mfa_setup_disable_button:{\"id\":\"column.mfa_disable_button\",\"defaultMessage\":\"Disable\"},disableFail:{\"id\":\"security.disable.fail\",\"defaultMessage\":\"Incorrect password. Try again.\"},mfaDisableSuccess:{\"id\":\"mfa.disable.success_message\",\"defaultMessage\":\"MFA disabled\"},passwordPlaceholder:{\"id\":\"mfa.mfa_setup.password_placeholder\",\"defaultMessage\":\"Password\"}});var DisableOtpForm=function DisableOtpForm(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var intl=useIntl();var dispatch=useAppDispatch();var history=useHistory();var handleSubmit=useCallback(function(){setIsLoading(true);dispatch(disableMfa('totp',password)).then(function(){toast.success(intl.formatMessage(messages.mfaDisableSuccess));history.push('../auth/edit');}).finally(function(){setIsLoading(false);}).catch(function(){toast.error(intl.formatMessage(messages.disableFail));});},[password,dispatch,intl]);var handleInputChange=function handleInputChange(event){setPassword(event.target.value);};return/*#__PURE__*/_jsx(Form,{onSubmit:handleSubmit},void 0,/*#__PURE__*/_jsx(Stack,{},void 0,/*#__PURE__*/_jsx(Text,{weight:\"medium\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"mfa.otp_enabled_title\",defaultMessage:\"OTP Enabled\"})),/*#__PURE__*/_jsx(Text,{theme:\"muted\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"mfa.otp_enabled_description\",defaultMessage:\"You have enabled two-factor authentication via OTP.\"}))),/*#__PURE__*/_jsx(FormGroup,{labelText:intl.formatMessage(messages.passwordPlaceholder),hintText:/*#__PURE__*/_jsx(FormattedMessage,{id:\"mfa.mfa_disable_enter_password\",defaultMessage:\"Enter your current password to disable two-factor auth.\"})},void 0,/*#__PURE__*/_jsx(Input,{type:\"password\",placeholder:intl.formatMessage(messages.passwordPlaceholder),name:\"password\",onChange:handleInputChange,disabled:isLoading,value:password,required:true})),/*#__PURE__*/_jsx(FormActions,{},void 0,/*#__PURE__*/_jsx(Button,{disabled:isLoading,theme:\"danger\",type:\"submit\",text:intl.formatMessage(messages.mfa_setup_disable_button)})));};export default DisableOtpForm;","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";import\"core-js/modules/es.array.map.js\";import\"core-js/modules/es.array.push.js\";import React,{useState,useEffect}from'react';import{useIntl,defineMessages,FormattedMessage}from'react-intl';import{useHistory}from'react-router-dom';import{fetchBackupCodes}from'soapbox/actions/mfa';import{Button,FormActions,Spinner,Stack,Text}from'soapbox/components/ui';import{useAppDispatch}from'soapbox/hooks';import toast from'soapbox/toast';var messages=defineMessages({mfaCancelButton:{\"id\":\"column.mfa_cancel\",\"defaultMessage\":\"Cancel\"},mfaSetupButton:{\"id\":\"column.mfa_setup\",\"defaultMessage\":\"Proceed to Setup\"},codesFail:{\"id\":\"security.codes.fail\",\"defaultMessage\":\"Failed to fetch backup codes\"}});var EnableOtpForm=function EnableOtpForm(_ref){var displayOtpForm=_ref.displayOtpForm,handleSetupProceedClick=_ref.handleSetupProceedClick;var dispatch=useAppDispatch();var intl=useIntl();var history=useHistory();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),backupCodes=_useState2[0],setBackupCodes=_useState2[1];useEffect(function(){dispatch(fetchBackupCodes()).then(function(_ref2){var backupCodes=_ref2.codes;setBackupCodes(backupCodes);}).catch(function(){toast.error(intl.formatMessage(messages.codesFail));});},[]);return/*#__PURE__*/_jsx(Stack,{space:4},void 0,/*#__PURE__*/_jsx(Stack,{space:4},void 0,/*#__PURE__*/_jsx(Text,{theme:\"muted\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"mfa.setup_warning\",defaultMessage:\"Write these codes down or save them somewhere secure - otherwise you won't see them again. If you lose access to your 2FA app and recovery codes you'll be locked out of your account.\"})),/*#__PURE__*/_jsx(\"div\",{className:\"rounded-lg border-2 border-solid border-gray-200 p-4 dark:border-gray-800\"},void 0,/*#__PURE__*/_jsx(Stack,{space:3},void 0,/*#__PURE__*/_jsx(Text,{weight:\"medium\",align:\"center\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"mfa.setup_recoverycodes\",defaultMessage:\"Recovery codes\"})),backupCodes.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 gap-3 rounded-lg text-center\"},void 0,backupCodes.map(function(code,i){return/*#__PURE__*/_jsx(Text,{theme:\"muted\",size:\"sm\"},i,code);})):/*#__PURE__*/_jsx(Spinner,{})))),!displayOtpForm&&/*#__PURE__*/_jsx(FormActions,{},void 0,/*#__PURE__*/_jsx(Button,{theme:\"tertiary\",text:intl.formatMessage(messages.mfaCancelButton),onClick:function onClick(){return history.push('../auth/edit');}}),backupCodes.length>0&&/*#__PURE__*/_jsx(Button,{theme:\"primary\",text:intl.formatMessage(messages.mfaSetupButton),onClick:handleSetupProceedClick})));};export default EnableOtpForm;","import\"core-js/modules/es.object.keys.js\";import\"core-js/modules/es.symbol.js\";import\"core-js/modules/es.array.filter.js\";import\"core-js/modules/es.object.to-string.js\";import\"core-js/modules/es.object.get-own-property-descriptor.js\";import\"core-js/modules/web.dom-collections.for-each.js\";import\"core-js/modules/es.object.get-own-property-descriptors.js\";import\"core-js/modules/es.object.define-properties.js\";import\"core-js/modules/es.object.define-property.js\";import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";import\"core-js/modules/es.array.push.js\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}import{QRCodeCanvas as QRCode}from'qrcode.react';import React,{useCallback,useEffect,useState}from'react';import{useIntl,FormattedMessage,defineMessages}from'react-intl';import{useHistory}from'react-router-dom';import{setupMfa,confirmMfa}from'soapbox/actions/mfa';import{Button,Form,FormActions,FormGroup,Input,Stack,Text}from'soapbox/components/ui';import{useAppDispatch}from'soapbox/hooks';import toast from'soapbox/toast';var messages=defineMessages({mfaCancelButton:{\"id\":\"column.mfa_cancel\",\"defaultMessage\":\"Cancel\"},mfaSetupConfirmButton:{\"id\":\"column.mfa_confirm_button\",\"defaultMessage\":\"Confirm\"},confirmFail:{\"id\":\"security.confirm.fail\",\"defaultMessage\":\"Incorrect code or password. Try again.\"},qrFail:{\"id\":\"security.qr.fail\",\"defaultMessage\":\"Failed to fetch setup key\"},mfaConfirmSuccess:{\"id\":\"mfa.confirm.success_message\",\"defaultMessage\":\"MFA confirmed\"},codePlaceholder:{\"id\":\"mfa.mfa_setup.code_placeholder\",\"defaultMessage\":\"Code\"},passwordPlaceholder:{\"id\":\"mfa.mfa_setup.password_placeholder\",\"defaultMessage\":\"Password\"}});var OtpConfirmForm=function OtpConfirmForm(){var intl=useIntl();var history=useHistory();var dispatch=useAppDispatch();var _useState=useState({password:'',isLoading:false,code:'',qrCodeURI:'',confirmKey:''}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];useEffect(function(){dispatch(setupMfa('totp')).then(function(data){setState(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{qrCodeURI:data.provisioning_uri,confirmKey:data.key});});}).catch(function(){toast.error(intl.formatMessage(messages.qrFail));});},[]);var handleInputChange=useCallback(function(event){event.persist();setState(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},event.target.name,event.target.value));});},[]);var handleSubmit=function handleSubmit(e){setState(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{isLoading:true});});dispatch(confirmMfa('totp',state.code,state.password)).then(function(r){toast.success(intl.formatMessage(messages.mfaConfirmSuccess));history.push('../auth/edit');}).catch(function(){toast.error(intl.formatMessage(messages.confirmFail));setState(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{isLoading:false});});});e.preventDefault();};return/*#__PURE__*/_jsx(Stack,{space:4},void 0,/*#__PURE__*/_jsx(Form,{onSubmit:handleSubmit},void 0,/*#__PURE__*/_jsx(Stack,{},void 0,/*#__PURE__*/_jsx(Text,{weight:\"semibold\",size:\"lg\"},void 0,\"1. \",/*#__PURE__*/_jsx(FormattedMessage,{id:\"mfa.mfa_setup_scan_title\",defaultMessage:\"Scan\"})),/*#__PURE__*/_jsx(Text,{theme:\"muted\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"mfa.mfa_setup_scan_description\",defaultMessage:\"Using your two-factor app, scan this QR code or enter the text key.\"}))),/*#__PURE__*/_jsx(QRCode,{className:\"rounded-lg\",value:state.qrCodeURI,includeMargin:true}),state.confirmKey,/*#__PURE__*/_jsx(Text,{weight:\"semibold\",size:\"lg\"},void 0,\"2. \",/*#__PURE__*/_jsx(FormattedMessage,{id:\"mfa.mfa_setup_verify_title\",defaultMessage:\"Verify\"})),/*#__PURE__*/_jsx(FormGroup,{labelText:intl.formatMessage(messages.codePlaceholder),hintText:/*#__PURE__*/_jsx(FormattedMessage,{id:\"mfa.mfa_setup.code_hint\",defaultMessage:\"Enter the code from your two-factor app.\"})},void 0,/*#__PURE__*/_jsx(Input,{name:\"code\",placeholder:intl.formatMessage(messages.codePlaceholder),onChange:handleInputChange,autoComplete:\"off\",disabled:state.isLoading,value:state.code,type:\"text\",required:true})),/*#__PURE__*/_jsx(FormGroup,{labelText:intl.formatMessage(messages.passwordPlaceholder),hintText:/*#__PURE__*/_jsx(FormattedMessage,{id:\"mfa.mfa_setup.password_hint\",defaultMessage:\"Enter your current password to confirm your identity.\"})},void 0,/*#__PURE__*/_jsx(Input,{type:\"password\",name:\"password\",placeholder:intl.formatMessage(messages.passwordPlaceholder),onChange:handleInputChange,disabled:state.isLoading,value:state.password,required:true})),/*#__PURE__*/_jsx(FormActions,{},void 0,/*#__PURE__*/_jsx(Button,{type:\"button\",theme:\"tertiary\",text:intl.formatMessage(messages.mfaCancelButton),onClick:function onClick(){return history.push('../auth/edit');},disabled:state.isLoading}),/*#__PURE__*/_jsx(Button,{type:\"submit\",theme:\"primary\",text:intl.formatMessage(messages.mfaSetupConfirmButton),disabled:state.isLoading}))));};export default OtpConfirmForm;","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{useIntl,defineMessages}from'react-intl';import{fetchMfa}from'soapbox/actions/mfa';import{Card,CardBody,CardHeader,CardTitle,Column,Stack}from'soapbox/components/ui';import{useAppSelector,useAppDispatch}from'soapbox/hooks';import DisableOtpForm from'./mfa/disable-otp-form';import EnableOtpForm from'./mfa/enable-otp-form';import OtpConfirmForm from'./mfa/otp-confirm-form';/*\nSecurity settings page for user account\nRouted to /settings/mfa\nIncludes following features:\n- Set up Multi-factor Auth\n*/var messages=defineMessages({heading:{\"id\":\"column.mfa\",\"defaultMessage\":\"Multi-Factor Authentication\"}});var MfaForm=function MfaForm(){var intl=useIntl();var dispatch=useAppDispatch();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),displayOtpForm=_useState2[0],setDisplayOtpForm=_useState2[1];useEffect(function(){dispatch(fetchMfa());},[]);var handleSetupProceedClick=function handleSetupProceedClick(event){event.preventDefault();setDisplayOtpForm(true);};var mfa=useAppSelector(function(state){return state.security.get('mfa');});return/*#__PURE__*/_jsx(Column,{label:intl.formatMessage(messages.heading),transparent:true,withHeader:false},void 0,/*#__PURE__*/_jsx(Card,{variant:\"rounded\"},void 0,/*#__PURE__*/_jsx(CardHeader,{backHref:\"/settings\"},void 0,/*#__PURE__*/_jsx(CardTitle,{title:intl.formatMessage(messages.heading)})),/*#__PURE__*/_jsx(CardBody,{},void 0,mfa.getIn(['settings','totp'])?/*#__PURE__*/_jsx(DisableOtpForm,{}):/*#__PURE__*/_jsx(Stack,{space:4},void 0,/*#__PURE__*/_jsx(EnableOtpForm,{displayOtpForm:displayOtpForm,handleSetupProceedClick:handleSetupProceedClick}),displayOtpForm&&/*#__PURE__*/_jsx(OtpConfirmForm,{})))));};export default MfaForm;"],"names":["messages","mfa_setup_disable_button","disableFail","mfaDisableSuccess","passwordPlaceholder","_useState","useState","_useState2","isLoading","setIsLoading","_useState3","_useState4","password","setPassword","intl","useIntl","dispatch","history","handleSubmit","useCallback","then","toast","formatMessage","push","finally","catch","onSubmit","weight","id","defaultMessage","theme","labelText","hintText","type","placeholder","name","onChange","event","target","value","disabled","required","text","mfaCancelButton","mfaSetupButton","codesFail","_ref","displayOtpForm","handleSetupProceedClick","backupCodes","setBackupCodes","useEffect","_ref2","codes","space","className","align","length","map","code","i","size","onClick","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","apply","_objectSpread","arguments","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","mfaSetupConfirmButton","confirmFail","qrFail","mfaConfirmSuccess","codePlaceholder","qrCodeURI","confirmKey","state","setState","data","prevState","provisioning_uri","handleInputChange","persist","e","r","preventDefault","includeMargin","autoComplete","heading","setDisplayOtpForm","mfa","security","get","label","transparent","withHeader","variant","backHref","title","getIn"],"sourceRoot":""}