{"version":3,"file":"packs/js/features/home_timeline-c64571aae4a5661546f2.chunk.js","mappings":"mOAAqrBA,GAAS,QAAe,CAACC,MAAM,CAAC,GAAK,cAAc,eAAiB,UAKm0B,UALxyB,WAAwB,IAAIC,GAAK,SAAcC,GAAS,UAAqBC,GAAS,UAAkBC,GAAS,UAAkBC,GAAQ,IAAAC,QAAO,MAAUC,GAAU,SAAe,SAASC,GAAO,IAAIC,EAAqB,OAAyI,KAA7E,QAApDA,EAAqBD,EAAME,UAAUC,IAAI,eAAwC,IAAvBF,OAA8B,EAAOA,EAAqBF,UAAkB,IAAOK,GAAiB,SAAe,SAASJ,GAAO,IAAIK,EAAsB,OAA4D,QAArDA,EAAsBL,EAAME,UAAUC,IAAI,eAAyC,IAAxBE,OAA+B,EAAOA,EAAsBC,aAAc,IAAOC,GAA2B,SAAe,SAASP,GAAO,OAAOI,EAAiBJ,EAAMQ,cAAcL,IAAIC,GAAkB,IAAK,IAEvzCK,EAAY,WAA0BZ,EAAQa,UAASC,cAAcd,EAAQa,SAASb,EAAQa,QAAQ,KAAM,EAGE,OAH0H,IAAAE,YAAU,WAAiC,OAAvYb,EAAWF,EAAQa,QAAQG,aAAY,WAAWnB,GAAS,UAAsB,GAAE,KAAYe,IAA+S,WAAWA,GAAc,CAAE,GAAE,CAACV,KAAY,IAAAa,YAAU,WACzfR,GAAkBV,GAAS,SAAmB,CAACU,IAAqB,GAAE,KAAI,IAAAQ,YAAU,YAEpFL,GAA8BA,SAAwEA,EAA2BO,YAAYpB,GAAS,WAAsBA,GAAS,QAAmB,CAAC,GAAE,WAAWA,GAAS,UAA+B,KAAK,GAAE,CAACU,KAAsC,OAAK,KAAO,CAACW,MAAMtB,EAAKuB,cAAczB,EAASC,OAAOyB,aAAY,EAAKC,YAAW,QAAO,GAAoB,OAAK,IAAc,CAACC,UAHlI,WAAyB,OAAOzB,GAAS,QAAmB,CAAC0B,MAAM,KAAKC,UAAUjB,IAAoB,QAGqD,GAAoB,OAAK,IAAS,CAACkB,UAAU,gBAAgBC,WALq/B,SAAwBH,GAAO1B,GAAS,QAAmB,CAAC0B,MAAMA,EAAMC,UAAUjB,IAAoB,EAKjkCoB,WAAW,OAAOC,WAAW,QAAQC,SAAQ,EAAKC,cAA0B,OAAK,KAAM,CAACC,MAAM,QAAG,GAAoB,OAAK,KAAK,CAACC,KAAK,KAAKC,OAAO,SAASC,MAAM,eAAU,GAAoB,OAAK,IAAiB,CAACC,GAAG,0BAA0BC,eAAe,sCAAkD,OAAK,KAAK,CAACC,MAAM,QAAQH,MAAM,eAAU,GAAoB,OAAK,IAAiB,CAACC,GAAG,6BAA6BC,eAAe,iEAAiEE,OAAO,CAACC,UAAUxC,EAASJ,UAAUG,EAAS0C,aAAyB,OAAK,KAAK,CAACH,MAAM,QAAQH,MAAM,eAAU,GAAoB,OAAK,IAAiB,CAACC,GAAG,oBAAoBC,eAAe,iEAAiEE,OAAO,CAACG,QAAoB,OAAK,KAAK,CAACC,GAAG,kBAAkBC,UAAU,+DAA0D,GAAoB,OAAK,IAAiB,CAACR,GAAG,8BAA8BC,eAAe,uBAAuBE,OAAO,CAACM,WAAW7C,EAASJ,kBAAmB,C","sources":["webpack://soapbox/./app/soapbox/features/home-timeline/index.tsx"],"sourcesContent":["import _jsx from\"@babel/runtime/helpers/esm/jsx\";import React,{useEffect,useRef}from'react';import{defineMessages,useIntl,FormattedMessage}from'react-intl';import{Link}from'react-router-dom';import{fetchRelationships}from'soapbox/actions/accounts';import{fetchSuggestionsForTimeline}from'soapbox/actions/suggestions';import{expandHomeTimeline}from'soapbox/actions/timelines';import PullToRefresh from'soapbox/components/pull-to-refresh';import{Column,Stack,Text}from'soapbox/components/ui';import Timeline from'soapbox/features/ui/components/timeline';import{useAppSelector,useAppDispatch,useFeatures,useInstance}from'soapbox/hooks';import{clearFeedAccountId}from'../../actions/timelines';var messages=defineMessages({title:{\"id\":\"column.home\",\"defaultMessage\":\"Home\"}});var HomeTimeline=function HomeTimeline(){var intl=useIntl();var dispatch=useAppDispatch();var features=useFeatures();var instance=useInstance();var polling=useRef(null);var isPartial=useAppSelector(function(state){var _state$timelines$get;return((_state$timelines$get=state.timelines.get('home'))===null||_state$timelines$get===void 0?void 0:_state$timelines$get.isPartial)===true;});var currentAccountId=useAppSelector(function(state){var _state$timelines$get2;return(_state$timelines$get2=state.timelines.get('home'))===null||_state$timelines$get2===void 0?void 0:_state$timelines$get2.feedAccountId;});var currentAccountRelationship=useAppSelector(function(state){return currentAccountId?state.relationships.get(currentAccountId):null;});var handleLoadMore=function handleLoadMore(maxId){dispatch(expandHomeTimeline({maxId:maxId,accountId:currentAccountId}));};// Mastodon generates the feed in Redis, and can return a partial timeline\n// (HTTP 206) for new users. Poll until we get a full page of results.\nvar checkIfReloadNeeded=function checkIfReloadNeeded(){if(isPartial){polling.current=setInterval(function(){dispatch(expandHomeTimeline());},3000);}else{stopPolling();}};var stopPolling=function stopPolling(){if(polling.current){clearInterval(polling.current);polling.current=null;}};var handleRefresh=function handleRefresh(){return dispatch(expandHomeTimeline({maxId:null,accountId:currentAccountId}));};useEffect(function(){checkIfReloadNeeded();return function(){stopPolling();};},[isPartial]);useEffect(function(){// Check to see if we still follow the user that is selected in the Feed Carousel.\nif(currentAccountId){dispatch(fetchRelationships([currentAccountId]));}},[]);useEffect(function(){// If we unfollowed the currently selected user from the Feed Carousel,\n// let's clear the feed filter and refetch fresh timeline data.\nif(currentAccountRelationship&&!(currentAccountRelationship!==null&&currentAccountRelationship!==void 0&&currentAccountRelationship.following)){dispatch(clearFeedAccountId());dispatch(expandHomeTimeline({},function(){dispatch(fetchSuggestionsForTimeline());}));}},[currentAccountId]);return/*#__PURE__*/_jsx(Column,{label:intl.formatMessage(messages.title),transparent:true,withHeader:false},void 0,/*#__PURE__*/_jsx(PullToRefresh,{onRefresh:handleRefresh},void 0,/*#__PURE__*/_jsx(Timeline,{scrollKey:\"home_timeline\",onLoadMore:handleLoadMore,timelineId:\"home\",divideType:\"space\",showAds:true,emptyMessage:/*#__PURE__*/_jsx(Stack,{space:1},void 0,/*#__PURE__*/_jsx(Text,{size:\"xl\",weight:\"medium\",align:\"center\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home.title\",defaultMessage:\"You're not following anyone yet\"})),/*#__PURE__*/_jsx(Text,{theme:\"muted\",align:\"center\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home.subtitle\",defaultMessage:\"{siteTitle} gets more interesting once you follow other users.\",values:{siteTitle:instance.title}})),features.federating&&/*#__PURE__*/_jsx(Text,{theme:\"muted\",align:\"center\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home\",defaultMessage:\"Or you can visit {public} to get started and meet other users.\",values:{public:/*#__PURE__*/_jsx(Link,{to:\"/timeline/local\",className:\"text-primary-600 hover:underline dark:text-primary-400\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.home.local_tab\",defaultMessage:\"the {site_title} tab\",values:{site_title:instance.title}}))}})))})));};export default HomeTimeline;"],"names":["messages","title","intl","dispatch","features","instance","polling","useRef","isPartial","state","_state$timelines$get","timelines","get","currentAccountId","_state$timelines$get2","feedAccountId","currentAccountRelationship","relationships","stopPolling","current","clearInterval","useEffect","setInterval","following","label","formatMessage","transparent","withHeader","onRefresh","maxId","accountId","scrollKey","onLoadMore","timelineId","divideType","showAds","emptyMessage","space","size","weight","align","id","defaultMessage","theme","values","siteTitle","federating","public","to","className","site_title"],"sourceRoot":""}