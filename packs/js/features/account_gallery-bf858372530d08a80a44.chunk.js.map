{"version":3,"file":"packs/js/features/account_gallery-bf858372530d08a80a44.chunk.js","mappings":"kPAAg1BA,EAAc,SAAuBC,GAAM,IAAIC,EAAMD,EAAKC,MAAMC,EAAWF,EAAKE,WAA4E,OAAmB,OAAK,IAAS,CAACC,QAAhF,WAA0BD,EAAWD,EAAO,GAA6D,EAA04I,UAAr3I,WAA0B,IAAIG,GAAS,UAA4CC,GAAZ,UAAgCA,SAAaC,GAAS,UAAkBC,GAAgB,SAAe,SAASC,GAAO,IAAIC,EAAoBC,EAA0BC,EAAGH,EAAMG,GAAOC,IAAmE,QAA9CH,EAAoBD,EAAMK,SAASC,KAAK,UAAkC,IAAtBL,OAA6B,EAAOA,EAAoBJ,WAAW,IAAIU,gBAAgBV,EAASU,cAAkBC,GAAW,EAAMC,EAAgBZ,EAAS,GAAGO,EAAmBI,EAAU,SAAU,CAAC,IAAIE,GAAQ,QAAsBV,EAAMH,GAAUW,EAAUE,EAAQA,EAAQC,IAAI,MAAM,EAAEF,GAAiBC,aAAiC,EAAOA,EAAQE,OAAO,E,CAAI,IAAIC,GAAgF,QAApEX,EAAsBF,EAAMc,cAAcR,IAAIS,OAAOP,WAA6C,IAAxBN,OAA+B,EAAOA,EAAsBc,cAAa,EAAM,MAAM,CAACR,UAAUA,EAAUS,YAAYd,IAAKK,GAAgBK,IAAYf,EAASoB,gBAAgBT,gBAAgBA,EAAiB,IAAGD,EAAUT,EAAgBS,UAAUS,EAAYlB,EAAgBkB,YAAYR,EAAgBV,EAAgBU,gBAAoBU,GAAU,SAAe,SAASnB,GAAO,QAAQA,EAAMK,SAASC,IAAIE,EAAW,IAAOY,GAAY,SAAe,SAASpB,GAAO,OAAO,QAAkBA,EAAMQ,EAAW,IAAOa,GAAU,SAAe,SAASrB,GAAO,IAAIsB,EAAqB,OAA0F,QAAnFA,EAAqBtB,EAAMuB,UAAUjB,IAAI,WAAWkB,OAAOhB,EAAU,kBAA2C,IAAvBc,OAA8B,EAAOA,EAAqBD,SAAU,IAAOI,GAAQ,SAAe,SAASzB,GAAO,IAAI0B,EAAsB,OAA2F,QAApFA,EAAsB1B,EAAMuB,UAAUjB,IAAI,WAAWkB,OAAOhB,EAAU,kBAA4C,IAAxBkB,OAA+B,EAAOA,EAAsBD,OAAQ,IAAOE,GAAK,IAAAC,QAAO,MAA4JC,EAAe,SAAwBpC,GAAUe,IAAwB,IAAbA,GAAgBZ,GAAS,QAA2BY,EAAU,CAACf,MAAMA,IAAU,EAAkGqC,EAAgB,SAAyBC,GAAY,GAAqB,UAAlBA,EAAWC,KAAgBpC,GAAS,QAAU,QAAQ,CAACqC,MAAMF,EAAWG,OAAOH,EAAWG,OAAOxB,QAAQqB,EAAWrB,eAAgB,CAAC,IAAIuB,EAAMF,EAAWG,OAAOC,kBAAsBC,EAAMH,EAAMI,WAAU,SAASC,GAAG,OAAOA,EAAE3B,KAAKoB,EAAWpB,EAAG,IAAGf,GAAS,QAAU,QAAQ,CAACqC,MAAMA,EAAMG,MAAMA,EAAMF,OAAOH,EAAWG,S,CAAW,EAAwM,IAAtM,IAAAK,YAAU,WAAc/B,IAAwB,IAAbA,GAAgBZ,GAAS,SAAaY,IAAYZ,GAAS,QAA2BY,KAAkBZ,GAAS,SAAuBC,GAAY,GAAE,CAACW,KAAgBW,IAAwB,IAAbX,EAAgB,OAAmB,OAAK,IAAiB,CAAC,GAAI,IAAgB,IAAbA,IAAiBY,GAAaC,EAAW,OAAmB,OAAK,KAAO,CAAC,OAAE,GAAoB,OAAK,KAAQ,CAAC,IAAK,IAAImB,EAAU,KAAyI,OAAjIf,GAAWJ,GAA8B,IAAnBD,EAAYqB,OAAWD,GAAuB,OAAK,IAAS,CAACE,SAASrB,EAAU1B,QAAn9B,SAAyBgD,GAAGA,EAAEC,iBAAzRnB,GAASI,EAAeT,EAAYqB,KAAK,EAAErB,EAAYyB,OAAOX,OAAOvB,QAAGmC,EAAyP,KAA26B7B,GAAgC,OAAK,KAAO,CAAC,OAAE,GAAoB,OAAK,MAAM,CAAC8B,UAAU,+BAA0B,GAAoB,OAAK,IAAiB,CAACpC,GAAG,mCAAmCqC,eAAe,2BAA8C,OAAK,KAAO,CAACC,MAAM,IAAIzB,OAAOf,GAAiByC,aAAY,EAAKC,YAAW,QAAO,EAAoB,gBAAoB,MAAM,CAACC,KAAK,OAAOL,UAAU,wCAAwCM,IAAI1B,GAAMP,EAAYkC,KAAI,SAASvB,EAAWK,GAAO,IAAImB,EAAiBC,EAAkB,OAAoB,OAAbzB,GAA+B,OAAKxC,EAAc,CAACE,MAAM2C,EAAM,IAAkD,QAA9CoB,EAAkBpC,EAAYd,IAAI8B,EAAM,UAAgC,IAApBoB,OAA2B,EAAOA,EAAkB7C,KAAU,KAAKjB,WAAWmC,GAAgB,SAAuD,QAA7C0B,EAAiBnC,EAAYd,IAAI8B,EAAM,UAA+B,IAAnBmB,OAA0B,EAAOA,EAAiB5C,MAAkB,OAAK,IAAU,CAACoB,WAAWA,EAAW0B,YAAY3B,GAAiB,GAAGN,OAAOO,EAAWG,OAAOvB,GAAG,KAAKa,OAAOO,EAAWpB,IAAK,KAAIU,GAA8B,IAAnBD,EAAYqB,OAAuB,OAAK,MAAM,CAACM,UAAU,+BAA0B,GAAoB,OAAK,IAAiB,CAACpC,GAAG,uBAAuBqC,eAAe,uBAAuBR,GAAWnB,GAA8B,IAAnBD,EAAYqB,OAAuB,OAAK,MAAM,CAACM,UAAU,sBAAiB,GAAoB,OAAK,KAAQ,CAAC,IAAK,C,oKCC92I,UADxN,SAA2BvD,GAAM,IAC5lBkE,EADgmBhD,EAAQlB,EAAKkB,QAAYd,GAAS,UAAqB+D,GAAU,IAAAC,WAAS,GAAMC,GAAW,OAAeF,EAAU,GAAGG,EAAQD,EAAW,GAAGE,EAAWF,EAAW,GAAOzC,GAAY,SAAe,SAASpB,GAAO,OAAOU,GAAQ,QAAkBV,EAAMU,aAAiC,EAAOA,EAAQC,KAAI,WAAgB,IAAOmB,EAAgB,SAAyBC,GAAY,GAAqB,UAAlBA,EAAWC,KAAgBpC,GAAS,QAAU,QAAQ,CAACqC,MAAMF,EAAWG,OAAOH,EAAWG,cAAe,CAAC,IAAID,EAAMF,EAAWiC,MAAM,CAAC,SAAS,sBAA0B5B,EAAMH,EAAMI,WAAU,SAASC,GAAG,OAAOA,EAAE3B,KAAKoB,EAAWpB,EAAG,IAAGf,GAAS,QAAU,QAAQ,CAACqC,MAAMA,EAAMG,MAAMA,EAAMF,OAAOH,EAAWG,S,CAAW,EACpwB,OADswB,IAAAK,YAAU,WAAWwB,GAAW,GAASrD,GAASd,GAAS,QAA2Bc,EAAQC,KACvqDsD,MAAK,WAAW,OAAOF,GAAW,EAAO,IAAGG,OAAM,WAAW,GAAI,GAAE,CAACxD,aAAiC,EAAOA,EAAQC,MAAkuB,OAAK,KAAO,CAACwD,OAAmB,OAAK,IAAiB,CAACxD,GAAG,oBAAoBqC,eAAe,gBAAW,EAAOtC,IAAsB,OAAK,MAAM,CAACqC,UAAU,eAAU,EAAOe,GAAqB,OAAK,KAAQ,CAAC,IAAxvBJ,EAA3GtC,EAAYgD,QAAO,SAASrC,GAAY,MAAmD,WAA5CA,EAAWiC,MAAM,CAAC,SAAS,cAA0B,IAAyCK,MAAM,EAAE,IAAuBC,WAAgU,OAAK,KAAK,CAAC7B,KAAK,KAAK8B,MAAM,cAAS,GAAoB,OAAK,IAAiB,CAAC5D,GAAG,4BAA4BqC,eAAe,sBAA/Z,OAAK,MAAM,CAACD,UAAU,+BAA0B,EAAOW,EAAgBJ,KAAI,SAASvB,EAAWyC,GAAQ,OAAmB,OAAK,IAAU,CAACzC,WAAWA,EAAW0B,YAAY3B,GAAiB,GAAGN,OAAOO,EAAWiC,MAAM,CAAC,SAAS,OAAO,KAAKxC,OAAOO,EAAWpB,IAAK,MAA6a,C","sources":["webpack://soapbox/./app/soapbox/features/account-gallery/index.tsx","webpack://soapbox/./app/soapbox/features/ui/components/profile-media-panel.tsx"],"sourcesContent":["import _jsx from\"@babel/runtime/helpers/esm/jsx\";import\"core-js/modules/es.array.find-index.js\";import\"core-js/modules/es.array.map.js\";import\"core-js/modules/es.array.concat.js\";import React,{useEffect,useRef}from'react';import{FormattedMessage}from'react-intl';import{useParams}from'react-router-dom';import{fetchAccount,fetchAccountByUsername}from'soapbox/actions/accounts';import{openModal}from'soapbox/actions/modals';import{expandAccountMediaTimeline}from'soapbox/actions/timelines';import LoadMore from'soapbox/components/load-more';import MissingIndicator from'soapbox/components/missing-indicator';import{Column,Spinner}from'soapbox/components/ui';import{useAppDispatch,useAppSelector,useFeatures}from'soapbox/hooks';import{getAccountGallery,findAccountByUsername}from'soapbox/selectors';import MediaItem from'./components/media-item';var LoadMoreMedia=function LoadMoreMedia(_ref){var maxId=_ref.maxId,onLoadMore=_ref.onLoadMore;var handleLoadMore=function handleLoadMore(){onLoadMore(maxId);};return/*#__PURE__*/_jsx(LoadMore,{onClick:handleLoadMore});};var AccountGallery=function AccountGallery(){var dispatch=useAppDispatch();var _useParams=useParams(),username=_useParams.username;var features=useFeatures();var _useAppSelector=useAppSelector(function(state){var _state$accounts$get,_state$relationships$;var me=state.me;var accountFetchError=(((_state$accounts$get=state.accounts.get(-1))===null||_state$accounts$get===void 0?void 0:_state$accounts$get.username)||'').toLowerCase()===username.toLowerCase();var accountId=-1;var accountUsername=username;if(accountFetchError){accountId=null;}else{var account=findAccountByUsername(state,username);accountId=account?account.id||null:-1;accountUsername=(account===null||account===void 0?void 0:account.acct)||'';}var isBlocked=((_state$relationships$=state.relationships.get(String(accountId)))===null||_state$relationships$===void 0?void 0:_state$relationships$.blocked_by)||false;return{accountId:accountId,unavailable:me===accountId?false:isBlocked&&!features.blockersVisible,accountUsername:accountUsername};}),accountId=_useAppSelector.accountId,unavailable=_useAppSelector.unavailable,accountUsername=_useAppSelector.accountUsername;var isAccount=useAppSelector(function(state){return!!state.accounts.get(accountId);});var attachments=useAppSelector(function(state){return getAccountGallery(state,accountId);});var isLoading=useAppSelector(function(state){var _state$timelines$get;return(_state$timelines$get=state.timelines.get(\"account:\".concat(accountId,\":media\")))===null||_state$timelines$get===void 0?void 0:_state$timelines$get.isLoading;});var hasMore=useAppSelector(function(state){var _state$timelines$get2;return(_state$timelines$get2=state.timelines.get(\"account:\".concat(accountId,\":media\")))===null||_state$timelines$get2===void 0?void 0:_state$timelines$get2.hasMore;});var node=useRef(null);var handleScrollToBottom=function handleScrollToBottom(){if(hasMore){handleLoadMore(attachments.size>0?attachments.last().status.id:undefined);}};var handleLoadMore=function handleLoadMore(maxId){if(accountId&&accountId!==-1){dispatch(expandAccountMediaTimeline(accountId,{maxId:maxId}));}};var handleLoadOlder=function handleLoadOlder(e){e.preventDefault();handleScrollToBottom();};var handleOpenMedia=function handleOpenMedia(attachment){if(attachment.type==='video'){dispatch(openModal('VIDEO',{media:attachment,status:attachment.status,account:attachment.account}));}else{var media=attachment.status.media_attachments;var index=media.findIndex(function(x){return x.id===attachment.id;});dispatch(openModal('MEDIA',{media:media,index:index,status:attachment.status}));}};useEffect(function(){if(accountId&&accountId!==-1){dispatch(fetchAccount(accountId));dispatch(expandAccountMediaTimeline(accountId));}else{dispatch(fetchAccountByUsername(username));}},[accountId]);if(!isAccount&&accountId!==-1){return/*#__PURE__*/_jsx(MissingIndicator,{});}if(accountId===-1||!attachments&&isLoading){return/*#__PURE__*/_jsx(Column,{},void 0,/*#__PURE__*/_jsx(Spinner,{}));}var loadOlder=null;if(hasMore&&!(isLoading&&attachments.size===0)){loadOlder=/*#__PURE__*/_jsx(LoadMore,{visible:!isLoading,onClick:handleLoadOlder});}if(unavailable){return/*#__PURE__*/_jsx(Column,{},void 0,/*#__PURE__*/_jsx(\"div\",{className:\"empty-column-indicator\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.account_unavailable\",defaultMessage:\"Profile unavailable\"})));}return/*#__PURE__*/_jsx(Column,{label:\"@\".concat(accountUsername),transparent:true,withHeader:false},void 0,/*#__PURE__*/React.createElement(\"div\",{role:\"feed\",className:\"grid grid-cols-2 gap-2 sm:grid-cols-3\",ref:node},attachments.map(function(attachment,index){var _attachments$get,_attachments$get2;return attachment===null?/*#__PURE__*/_jsx(LoadMoreMedia,{maxId:index>0?((_attachments$get2=attachments.get(index-1))===null||_attachments$get2===void 0?void 0:_attachments$get2.id)||null:null,onLoadMore:handleLoadMore},'more:'+((_attachments$get=attachments.get(index+1))===null||_attachments$get===void 0?void 0:_attachments$get.id)):/*#__PURE__*/_jsx(MediaItem,{attachment:attachment,onOpenMedia:handleOpenMedia},\"\".concat(attachment.status.id,\"+\").concat(attachment.id));}),!isLoading&&attachments.size===0&&/*#__PURE__*/_jsx(\"div\",{className:\"empty-column-indicator\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"account_gallery.none\",defaultMessage:\"No media to show.\"})),loadOlder),isLoading&&attachments.size===0&&/*#__PURE__*/_jsx(\"div\",{className:\"slist__append\"},void 0,/*#__PURE__*/_jsx(Spinner,{})));};export default AccountGallery;","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";import\"core-js/modules/es.array.find-index.js\";import\"core-js/modules/es.array.filter.js\";import\"core-js/modules/es.object.to-string.js\";import\"core-js/modules/es.array.slice.js\";import\"core-js/modules/es.array.map.js\";import\"core-js/modules/es.array.concat.js\";import{List as ImmutableList}from'immutable';import React,{useState,useEffect}from'react';import{FormattedMessage}from'react-intl';import{openModal}from'soapbox/actions/modals';import{expandAccountMediaTimeline}from'soapbox/actions/timelines';import{Spinner,Text,Widget}from'soapbox/components/ui';import{useAppDispatch,useAppSelector}from'soapbox/hooks';import{getAccountGallery}from'soapbox/selectors';import MediaItem from'../../account-gallery/components/media-item';var ProfileMediaPanel=function ProfileMediaPanel(_ref){var account=_ref.account;var dispatch=useAppDispatch();var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var attachments=useAppSelector(function(state){return account?getAccountGallery(state,account===null||account===void 0?void 0:account.id):ImmutableList();});var handleOpenMedia=function handleOpenMedia(attachment){if(attachment.type==='video'){dispatch(openModal('VIDEO',{media:attachment,status:attachment.status}));}else{var media=attachment.getIn(['status','media_attachments']);var index=media.findIndex(function(x){return x.id===attachment.id;});dispatch(openModal('MEDIA',{media:media,index:index,status:attachment.status}));}};useEffect(function(){setLoading(true);if(account){dispatch(expandAccountMediaTimeline(account.id))// @ts-ignore yes it does\n.then(function(){return setLoading(false);}).catch(function(){});}},[account===null||account===void 0?void 0:account.id]);var renderAttachments=function renderAttachments(){var publicAttachments=attachments.filter(function(attachment){return attachment.getIn(['status','visibility'])==='public';});var nineAttachments=publicAttachments.slice(0,9);if(!nineAttachments.isEmpty()){return/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-3 gap-1\"},void 0,nineAttachments.map(function(attachment,_index){return/*#__PURE__*/_jsx(MediaItem,{attachment:attachment,onOpenMedia:handleOpenMedia},\"\".concat(attachment.getIn(['status','id']),\"+\").concat(attachment.id));}));}else{return/*#__PURE__*/_jsx(Text,{size:\"sm\",theme:\"muted\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"media_panel.empty_message\",defaultMessage:\"No media found.\"}));}};return/*#__PURE__*/_jsx(Widget,{title:/*#__PURE__*/_jsx(FormattedMessage,{id:\"media_panel.title\",defaultMessage:\"Media\"})},void 0,account&&/*#__PURE__*/_jsx(\"div\",{className:\"w-full\"},void 0,loading?/*#__PURE__*/_jsx(Spinner,{}):renderAttachments()));};export default ProfileMediaPanel;"],"names":["LoadMoreMedia","_ref","maxId","onLoadMore","onClick","dispatch","username","features","_useAppSelector","state","_state$accounts$get","_state$relationships$","me","accountFetchError","accounts","get","toLowerCase","accountId","accountUsername","account","id","acct","isBlocked","relationships","String","blocked_by","unavailable","blockersVisible","isAccount","attachments","isLoading","_state$timelines$get","timelines","concat","hasMore","_state$timelines$get2","node","useRef","handleLoadMore","handleOpenMedia","attachment","type","media","status","media_attachments","index","findIndex","x","useEffect","loadOlder","size","visible","e","preventDefault","last","undefined","className","defaultMessage","label","transparent","withHeader","role","ref","map","_attachments$get","_attachments$get2","onOpenMedia","nineAttachments","_useState","useState","_useState2","loading","setLoading","getIn","then","catch","title","filter","slice","isEmpty","theme","_index"],"sourceRoot":""}