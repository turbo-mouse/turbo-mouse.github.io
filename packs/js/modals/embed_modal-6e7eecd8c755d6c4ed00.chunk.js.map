{"version":3,"file":"packs/js/modals/embed_modal-6e7eecd8c755d6c4ed00.chunk.js","mappings":"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","sources":["webpack://soapbox/./app/soapbox/components/safe-embed.tsx","webpack://soapbox/./app/soapbox/features/ui/components/modals/embed-modal.tsx","webpack://soapbox/./app/soapbox/queries/embed.ts"],"sourcesContent":["import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useRef,useState}from'react';/** Safely embeds arbitrary HTML content on the page (by putting it in an iframe). */var SafeEmbed=function SafeEmbed(_ref){var className=_ref.className,sandbox=_ref.sandbox,title=_ref.title,html=_ref.html;var iframe=useRef(null);var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),height=_useState2[0],setHeight=_useState2[1];var handleMessage=useCallback(function(e){var _e$data;if(((_e$data=e.data)===null||_e$data===void 0?void 0:_e$data.type)==='setHeight'){var _e$data2;setHeight((_e$data2=e.data)===null||_e$data2===void 0?void 0:_e$data2.height);}},[]);useEffect(function(){var _iframe$current,_iframe$current$conte;var iframeDocument=(_iframe$current=iframe.current)===null||_iframe$current===void 0?void 0:(_iframe$current$conte=_iframe$current.contentWindow)===null||_iframe$current$conte===void 0?void 0:_iframe$current$conte.document;if(iframeDocument&&html){var _iframe$current2,_iframe$current2$cont;iframeDocument.open();iframeDocument.write(html);iframeDocument.close();iframeDocument.body.style.margin='0';(_iframe$current2=iframe.current)===null||_iframe$current2===void 0?void 0:(_iframe$current2$cont=_iframe$current2.contentWindow)===null||_iframe$current2$cont===void 0?void 0:_iframe$current2$cont.addEventListener('message',handleMessage);var innerFrame=iframeDocument.querySelector('iframe');if(innerFrame){innerFrame.width='100%';}}return function(){var _iframe$current3,_iframe$current3$cont;(_iframe$current3=iframe.current)===null||_iframe$current3===void 0?void 0:(_iframe$current3$cont=_iframe$current3.contentWindow)===null||_iframe$current3$cont===void 0?void 0:_iframe$current3$cont.removeEventListener('message',handleMessage);};},[iframe.current,html]);return/*#__PURE__*/React.createElement(\"iframe\",{ref:iframe,className:className,sandbox:sandbox,height:height,title:title});};export default SafeEmbed;","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import React,{useEffect}from'react';import{FormattedMessage}from'react-intl';import{closeModal}from'soapbox/actions/modals';import CopyableInput from'soapbox/components/copyable-input';import SafeEmbed from'soapbox/components/safe-embed';import{Modal,Stack,Text,Divider}from'soapbox/components/ui';import{useAppDispatch}from'soapbox/hooks';import useEmbed from'soapbox/queries/embed';var EmbedModal=function EmbedModal(_ref){var url=_ref.url,onError=_ref.onError;var dispatch=useAppDispatch();var _useEmbed=useEmbed(url),embed=_useEmbed.data,error=_useEmbed.error,isError=_useEmbed.isError;useEffect(function(){if(error&&isError){onError(error);}},[isError]);var handleClose=function handleClose(){dispatch(closeModal('EMBED'));};return/*#__PURE__*/_jsx(Modal,{title:/*#__PURE__*/_jsx(FormattedMessage,{id:\"status.embed\",defaultMessage:\"Embed post\"}),onClose:handleClose},void 0,/*#__PURE__*/_jsx(Stack,{space:4},void 0,/*#__PURE__*/_jsx(Text,{theme:\"muted\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"embed.instructions\",defaultMessage:\"Embed this post on your website by copying the code below.\"})),/*#__PURE__*/_jsx(CopyableInput,{value:(embed===null||embed===void 0?void 0:embed.html)||''})),/*#__PURE__*/_jsx(\"div\",{className:\"py-9\"},void 0,/*#__PURE__*/_jsx(Divider,{})),/*#__PURE__*/_jsx(SafeEmbed,{className:\"w-full overflow-hidden rounded-xl\",sandbox:\"allow-same-origin allow-scripts\",title:\"embedded-status\",html:embed===null||embed===void 0?void 0:embed.html}));};export default EmbedModal;","import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import\"regenerator-runtime/runtime.js\";import{useQuery}from'@tanstack/react-query';import{useApi}from'soapbox/hooks';/** Fetch OEmbed information for a status by its URL. */ // https://github.com/mastodon/mastodon/blob/main/app/controllers/api/oembed_controller.rb\n// https://github.com/mastodon/mastodon/blob/main/app/serializers/oembed_serializer.rb\nexport default function useEmbed(url){var api=useApi();var getEmbed=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee(){var _yield$api$get,data;return regeneratorRuntime.wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return api.get('/api/oembed',{params:{url:url}});case 2:_yield$api$get=_context.sent;data=_yield$api$get.data;return _context.abrupt(\"return\",data);case 5:case\"end\":return _context.stop();}},_callee);}));return function getEmbed(){return _ref.apply(this,arguments);};}();return useQuery(['embed',url],getEmbed);}"],"names":["_ref","className","sandbox","title","html","iframe","useRef","_useState","useState","undefined","_useState2","height","setHeight","handleMessage","useCallback","e","_e$data","_e$data2","data","type","useEffect","_iframe$current","_iframe$current$conte","iframeDocument","current","contentWindow","document","_iframe$current2","_iframe$current2$cont","open","write","close","body","style","margin","addEventListener","innerFrame","querySelector","width","_iframe$current3","_iframe$current3$cont","removeEventListener","ref","url","onError","dispatch","_useEmbed","api","getEmbed","regeneratorRuntime","mark","_callee","_yield$api$get","wrap","_context","prev","next","get","params","sent","abrupt","stop","apply","this","arguments","useQuery","useEmbed","embed","error","isError","id","defaultMessage","onClose","space","theme","value"],"sourceRoot":""}